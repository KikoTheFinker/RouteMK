<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Details & Reviews</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/trip-details.css}"/>
</head>
<body class="bg-light">
<div class="container d-flex justify-content-center mx-auto mt-3 pt-5">
    <div class="w-75 mx-2 my-3">
        <div class="title-container mt-3">
            <h1 class="badgify theme-trips"><i class="bi bi-list"></i>Trip details</h1>
        </div>

        <div class="row g-4">
            <!-- Left Column -->
            <div class="col-lg-5">
                <div class="card shadow make-good-box">
                    <div class="card-body">
                        <h2 class="h5 text-danger border-bottom pb-2 mb-3">
                            <i class="fas fa-info-circle"></i> Trip Information
                        </h2>

                        <div class="list-group list-group-flush">
                            <div class="list-group-item d-flex align-items-center">
                                <div class="me-3 text-danger"><i class="fas fa-map-marker-alt fa-lg"></i></div>
                                <div>
                                    <strong class="text-muted small d-block">Route</strong>
                                    <span class="fw-semibold text-dark">
                  <span class="text-primary" th:text="${trip.route.source.name}"></span>
                  <i class="fas fa-arrow-right mx-2 text-secondary"></i>
                  <span class="text-danger" th:text="${trip.route.destination.name}"></span>
                </span>
                                </div>
                            </div>

                            <div class="list-group-item d-flex align-items-center">
                                <div class="me-3 text-danger"><i class="fas fa-calendar-day fa-lg"></i></div>
                                <div>
                                    <strong class="text-muted small d-block">Date</strong>
                                    <span th:text="${trip.date}"></span>
                                </div>
                            </div>

                            <div class="list-group-item d-flex align-items-center">
                                <div class="me-3 text-danger"><i class="fas fa-bus fa-lg"></i></div>
                                <div>
                                    <strong class="text-muted small d-block">Organizer</strong>
                                    <span th:text="${trip.tranOrg.companyName}"></span>
                                </div>
                            </div>

                            <div class="list-group-item d-flex align-items-center">
                                <div class="me-3 text-danger"><i class="fas fa-chair fa-lg"></i></div>
                                <div>
                                    <strong class="text-muted small d-block">Free Seats</strong>
                                    <span th:text="${trip.freeSeats}"></span>
                                </div>
                            </div>

                            <div class="list-group-item d-flex align-items-center">
                                <div class="me-3 text-danger"><i class="fas fa-tasks fa-lg"></i></div>
                                <div>
                                    <strong class="text-muted small d-block">Status</strong>
                                    <span th:text="${trip.status}"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Stops Timeline -->
                        <div class="mt-4">
                            <h3 class="h6 text-dark mb-3"><i class="fas fa-map-marked-alt"></i> Route Stops</h3>
                            <div class="timeline">
                                <div class="stop-item" th:each="stop : ${trip.stops}">
                                    <div class="fw-bold text-danger me-3 stop-time" th:text="${stop.stopTime}"></div>
                                    <div class="bg-light rounded px-3 py-2 stop-location"
                                         th:text="${stop.location.name}"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-7">
                <div class="card shadow make-good-box">
                    <div class="card-body">
                        <h2 class="h5 text-danger border-bottom pb-2 mb-3">
                            <i class="fas fa-star"></i> Leave a Review
                        </h2>

                        <!-- Review Form -->
                        <form class="mb-4" th:action="@{'/trips/' + ${trip.tripId} + '/reviews'}" method="post">
                            <div class="mb-3">
                                <label for="description" class="form-label fw-semibold">
                                    <i class="fas fa-comment-dots"></i> Your Review
                                </label>
                                <textarea id="description" name="description" class="form-control" rows="4"
                                          placeholder="Share your experience..."></textarea>
                            </div>

                            <div class="mb-3 p-3 bg-light rounded make-good-box">
                                <label class="form-label fw-semibold"><i class="fas fa-star"></i> Rating</label>
                                <div class="star-rating mt-2">
                                    <input type="radio" id="star5" name="rating" value="5"/><label for="star5"></label>
                                    <input type="radio" id="star4" name="rating" value="4"/><label for="star4"></label>
                                    <input type="radio" id="star3" name="rating" value="3"/><label for="star3"></label>
                                    <input type="radio" id="star2" name="rating" value="2"/><label for="star2"></label>
                                    <input type="radio" id="star1" name="rating" value="1"/><label for="star1"></label>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-danger shadow">
                                <i class="fas fa-paper-plane"></i> Submit Review
                            </button>
                        </form>

                        <div th:if="${errorMessage}">
                            <p class="text-danger" th:text="${errorMessage}"></p>
                        </div>

                        <!-- Existing Reviews -->
                        <div th:if="${reviews != null}">
                            <h3 class="h6 text-dark border-bottom pb-2 mb-3"><i class="fas fa-comments"></i> Reviews
                            </h3>
                            <div class="mb-3 p-3 rounded shadow-sm make-good-box bg-white"
                                 th:each="review : ${reviews}">
                                <div class="d-flex justify-content-between mb-2">
                                    <div class="fw-semibold text-dark">
                                        <span th:text="${review.account.name + ' ' + review.account.surname}">User Name</span>
                                    </div>
                                    <div class="text-danger fw-bold"
                                         th:text="'★ ' + ${#numbers.formatDecimal(review.rating, 1, 1)}">★ 5.0
                                    </div>
                                </div>
                                <p class="text-muted mb-0" th:text="${review.description}">
                                </p>
                                <form th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')') or review.account.accountId == accountId}"
                                      th:action="@{/trips/{tripId}/removeReview/{reviewId}(tripId=${trip.tripId}, reviewId=${review.reviewId})}"
                                      th:method="post" class="d-inline">
                                    <div class="d-flex justify-content-end">
                                        <button type="submit" class="btn btn-danger mt-2">
                                            <i class="bi bi-trash3 me-2"></i>Remove Review
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
