<head>
    <meta charset="UTF-8">
    <title>Our Vehicles</title>
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/trip-route-filter-table.css}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
</head>
<body>
<div class="container d-flex justify-content-center mx-auto mt-3 pt-5" th:fragment="content">
    <div class="w-75 mx-2 my-3">

        <div class="title-container mt-3 d-flex justify-content-between align-items-center">
            <h1 class="badgify theme-vehicles">
                <i class="bi bi-truck me-2 icon-vehicles"></i>Our Vehicles
            </h1>
            <a class="btn-redoutline" th:href="@{/vehicles/new}">
                <i class="bi bi-plus-lg me-1"></i>Register a Vehicle
            </a>
        </div>

        <div th:if="${infoMessage}" class="alert alert-info my-2 text-center">
            <i class="bi bi-info-circle"></i>
            <span th:text="${infoMessage}"></span>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger my-2 text-center">
            <i class="bi bi-exclamation-triangle"></i>
            <span th:text="${errorMessage}"></span>
        </div>

        <div class="card p-3 m-0 mb-2 shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="m-0"><i class="bi bi-list-ul me-2"></i>Vehicles</h5>
                <span class="badge bg-light text-dark">
                    <i class="bi bi-bus-front me-1"></i>
                    <span th:text="${#lists.size(vehicles)}"></span> total
                </span>
            </div>

            <div th:if="${#lists.isEmpty(vehicles)}" class="text-muted text-center py-3">
                <i class="bi bi-emoji-neutral me-1"></i>No vehicles yet. Click “Register a Vehicle” to add one.
            </div>

            <div th:if="${!#lists.isEmpty(vehicles)}" class="table-responsive">
                <table class="table align-middle">
                    <thead>
                    <tr>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Capacity</th>
                        <th>Year</th>
                        <th>Drivers</th>
                        <th class="text-end">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="v : ${vehicles}">
                        <td th:text="${v.brand}"></td>
                        <td th:text="${v.model}"></td>
                        <td th:text="${v.capacity}"></td>
                        <td th:text="${v.yearManufactured}"></td>
                        <td>
                            <span th:each="d : ${driversPerVehicle[v.vehicleId]}"
                                  class="badge bg-secondary me-1"
                                  th:text="${(d.account != null ? ( (d.account.name != null ? d.account.name : '') + ' ' + (d.account.surname != null ? d.account.surname : '') ).trim() : 'Driver #' + d.driverId)}">
                            </span>
                        </td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary me-1"
                               th:href="@{/vehicles/{id}/assign(id=${v.vehicleId})}">
                                <i class="bi bi-people me-1"></i>Assign
                            </a>
                            <a class="btn btn-sm btn-outline-secondary me-1"
                               th:href="@{/vehicles/{id}/edit(id=${v.vehicleId})}">
                                <i class="bi bi-pencil-square me-1"></i>Edit
                            </a>
                            <form th:action="@{/vehicles/{id}/delete(id=${v.vehicleId})}" method="post" class="d-inline">
                                <button class="btn btn-sm btn-outline-danger" type="submit"
                                        onclick="return confirm('Delete this vehicle?')">
                                    <i class="bi bi-trash3 me-1"></i>Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
</body>
